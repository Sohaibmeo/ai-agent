0. Tech Stack (for Codex)

Frontend: React + TypeScript

Backend: Node.js + TypeScript + Express (or similar)

DB: Postgres

LLM orchestration: LangChain JS + OpenAI / local OpenAI-compatible model

Validation: Zod

1. System Overview

Build a UK-focused AI meal planner that:

Collects user profile & preferences

Generates 7-day meal plans that respect budget, diet, difficulty, and portion mode

Allows deep plan editing (ingredient/meal/day/week)

Produces a grocery list based on the plan

Lets users override ingredient prices and track pantry items

Uses Coach Agent + Review Agent (LangChain) to generate and modify plans

Provides a dashboard UI with left navigation tabs:

Profile

Plans

Groceries

2. Frontend Structure & Flows
2.1 Overall Layout

A Dashboard layout with:

Left sidebar navigation (vertical tabs)

Main content area on the right

Left Sidebar Tabs

Profile

Plans

Groceries

User lands on Profile when visiting the app for the first time. They can always come back to change preferences.

2.2 Profile Page (Tab: “Profile”)

This is the onboarding + settings page.

Sections

Basic Info

Age (number)

Height (cm)

Weight (kg)

Activity level (dropdown: sedentary / light / moderate / active)

Dietary Requirements

Select one: none / halal / vegan / vegetarian / keto / gluten-free / lactose-free

Internally maps to ingredient avoid lists (e.g. halal → no pork/alcohol)

Preferences

Ingredients preferred (multi-select / tags input)

Ingredients to avoid

Must-have ingredients

Recipes preferred (optional)

Cuisines liked

Cuisines disliked

Meal Schedule

Toggles:

Breakfast: ON/OFF

Snacks: ON/OFF

Lunch: ON/OFF

Dinner: ON/OFF

Difficulty & Portion Mode

Recipe difficulty: super easy / easy / medium / hard

Portion mode:

Cutting

Maintenance

Bulking

Weekly Budget

Numeric input in GBP (optional but recommended)

Backend

GET /api/user/profile → load existing profile & preferences

PUT /api/user/profile → save all profile + preference data in one go

2.3 Plans Page (Tab: “Plans”)

This page is both:

Plans overview (history)

Current plan view + controls

Layout

Top section: “Generate / Current Plan”

Button: “Generate New Week”

If a current plan exists:

Show summary card:

Week starting date

Total estimated cost

Total calories

Status (draft / active)

Button / link: “View Full Plan” (or show directly below)

Middle/Lower section: “Plan History”

List of past plans:

Week start date

Status (active / superseded)

Summary cost and calories

Click to view details (read-only)

Current Plan Detail View

This is where all the AI + interaction lives.

Structure:

Weekly header:

Week dates

Total cost, total kcal

Small note: “All values are estimates”

For each day (0–6):

Day label (e.g. Monday, etc.)

Daily cost & daily kcal

Within each day: list of meals in order (breakfast, snack, lunch, dinner if enabled)

Each meal card shows:

Meal name (recipe name)

Macros summary

Estimated cost

Portion info (e.g. “1.2x portion (bulking)”)

Regenerate icon (e.g. a small circular arrow in top-right of the meal card)

Under each meal, show ingredients:

For each ingredient row, show:

Name

Quantity + unit

Cost (optional)

Text actions (no buttons, just clickable inline text):

remove → remove ingredient from this meal

swap → open a small menu or just trigger default swap alternatives

avoid in future → adds to preference avoid list

prefer in future → adds to preference preferred list

All these text actions should look like links (e.g. underlined or secondary text style).

Plan Interactions (how user triggers flows)

At different levels:

Week level:

Text link like: “Regenerate whole week”

Text link: “Swap all [ingredient] this week” (e.g. UI that lets you choose an ingredient name from a dropdown)

Dropdown or section to change portion mode or difficulty for the whole week (optional for v1, but spec supports it)

Day level:

Text like: “regenerate this day” (positioned near the day heading)

Meal level:

Regenerate icon (top-right of meal card)

Clicking shows a small menu:

“healthier”

“cheaper”

“higher protein”

“easier to cook”

“turn into smoothie/drinkable” (if applicable)

Ingredients list with inline text actions:

remove, swap, avoid in future, prefer in future

When user clicks any of these, frontend calls:

POST /api/plan/action with: